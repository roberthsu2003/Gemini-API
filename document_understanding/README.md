## 讀取文件(Document_understanding)
Gemini API 支援pdf輸入,保含長的文件,最高達3600頁。Gemini模型使用原生視覺處理pdf檔,因此能夠了解文字和圖像內容.透過原生pdf視覺支援,Gemini模型能夠:
- 分析文件中的圖解說明,圖表和表格
- 提取資訊轉換成為結構化資料
- 回答有關於視覺所見和文字內容的問題
- 摘要文件內容
- 抄錄文件內容(例如轉換為HTML),保留版面和格式,以便給其它應用程式使用(例如資料庫或向量資料庫)

本教學課程示範了一些將Gemini API與PDF文件結合的可能方式,所有輸出皆為純文字

## 對pdf進行提示(Prompting with PDFs)

這指南示範如何處理遠端pdf和本地端pdf上傳至模型。

文件必需是下列格式的其中一種資料格式

- pdf - application/pdf
- javascript - application/x-javascript,text/javascript
- python - application/x-python, text/x-python
- txt - text/plain
- html - text/html
- css - text/css
- markdown - text/md
- csv - text/csv
- xml - text/xml
- rtf - text/rtf

每個文件頁面相當258tokens
### 透過internet取得pdf資料

```pytho
import httpx
import base64
import google.generativeai as genai
import os
from IPython.display import display,Markdown,Latex

genai.configure(api_key=os.environ['GEMINI_API_KEY'])
model = genai.GenerativeModel(
    model_name="gemini-2.0-flash-exp"
)
doc_url = "https://discovery.ucl.ac.uk/id/eprint/10089234/1/343019_3_art_0_py4t4l_convrt.pdf"

doc_data = base64.standard_b64encode(httpx.get(doc_url).content).decode("utf-8")

prompt = "總結這文件"

response = model.generate_content(
    contents=[{
        'mime_type':'application/pdf',
        'data': doc_data
    },prompt]
)
display(Markdown(response.text))

```

**輸出結果**

```markdown
當然，以下是這份文件的重點總結：

**主題：** 該論文介紹了一種名為 AlphaFold 的新型蛋白質結構預測方法，該方法利用深度學習和基於距離的潛在能量函數。

**核心概念：**

1.  **基於距離的預測：** AlphaFold 訓練一個神經網絡來預測蛋白質中胺基酸殘基對之間的距離，而不是直接預測接觸。研究表明基於距離的預測比基於接觸的預測提供了更多有關蛋白質結構的信息。

2.  **深度學習：** 該系統使用深度卷積殘差神經網絡（Deep Convolutional Residual Network）從蛋白質序列的多序列比對（MSA）數據中提取特徵，並預測殘基對之間的距離分佈。

3.  **基於潛在能量函數的結構生成：** AlphaFold 將預測的距離分佈轉換為蛋白質特異性的潛在能量函數，然後使用梯度下降算法來優化蛋白質結構。這個過程包括對結構的扭轉角進行優化，並將殘基對之間的距離約束考慮在內。

4.  **無模板預測：** 論文重點強調 AlphaFold 在無模板（free modelling）場景下的性能，證明即使沒有同源結構作為模板，它也能產生高精度的結構。

**主要發現和貢獻：**

*   **卓越的預測精度：** 在 CASP13 蛋白質結構預測競賽中，AlphaFold 的表現超越了所有其他參與者，它能夠以高精度預測更多 FM（Free Modelling）類的蛋白質結構。它在自由建模域的準確率（TM-score）大幅提高，同時在基於模板建模（Template-Based Modelling）上也表現出色。
*   **快速且高效的優化：** AlphaFold 通過簡單的梯度下降優化過程，在不需要複雜的抽樣程序的情況下實現了蛋白質結構的準確預測。
*   **潛在能量函數的有效性：** 通過訓練一個神經網絡預測殘基之間的距離，並將這些距離信息轉化為蛋白質特異性的潛在能量函數，並對該潛在能量函數進行優化，可以得到準確的結構預測，這證明了基於距離的預測的有效性。
*   **對生物學的啟示：** AlphaFold 結構預測精度的提高有望幫助理解蛋白質的功能和異常，尤其是在沒有實驗確定的同源蛋白質的情況下。其高精度結構預測能應用於蛋白-蛋白交互介面、分子對接和結晶學中，從而提高對生物學過程的理解。

**方法詳解：**

*   論文中詳述了從 MSA 數據生成特徵、深度學習網絡的架構、如何將距離信息轉化為能量函數、以及如何使用梯度下降算法生成蛋白質結構。
*   其中關鍵的技術包括：使用 dilated convolution 提高預測距離信息時的效率，以及加入雜訊重新初始化（noisy restarts）提高結構預測的準確度等。
*   為了衡量模型能力，論文中使用了多種評估指標，包括 TM-score、GDT-TS、IDDT、RMSD 等。此外，還使用了集成梯度（Integrated Gradients）的方法來分析神經網絡是如何學習到距離信息的。

**總結:** AlphaFold 是一項重大突破，在蛋白質結構預測領域取得了顯著進展。它通過結合深度學習、基於距離的預測和有效的優化算法，為生物學研究帶來了更準確和可用的蛋白質結構預測方法。此外，這篇論文也展示了如何分析神經網絡學習到的複雜規則，幫助理解模型的工作原理。
```

### 本地端pdf(檔案20MB以下)

```
import httpx
import base64
import google.generativeai as genai
import os
from IPython.display import display,Markdown,Latex

genai.configure(api_key=os.environ['GEMINI_API_KEY'])
model = genai.GenerativeModel(
    model_name="gemini-2.0-flash-exp"
)

doc_path = '說明書.pdf'
with open(doc_path, "rb") as doc_file:
    doc_data = base64.standard_b64encode(doc_file.read()).decode("utf-8")

prompt = "總結這文件"

response = model.generate_content([
    {
        'mime_type':'application/pdf',
        'data':doc_data
    },
    prompt
])

display(Markdown(response.text))
```

**輸出總結**

```markdown
這是一個關於富士通壁掛式空調機的使用說明書。以下為文件的重點總結：

**重要安全注意事項**

*   警告：強調有死亡或嚴重傷害的風險，以及禁止和必須執行的行為。
*   注意：強調有傷害或財物受損的危險。
*   提醒用戶必須聯絡授權維修人員進行維修、安裝及移機。
*   強調避免損壞電源線、洩漏冷媒、雷雨天氣時觸摸機器。
*   提醒用戶勿使用可燃氣體或讓冷風直吹身體。
*   警告用戶要正確處置本產品，並避免兒童戲玩本機。
*   其他安全警告包括禁止用濕手操作、在不穩定的梯子上進行清潔等。

**零件描述和操作**

*   列出室內機組的附件，包括遙控器、遙控器座、自攻螺絲、電池、抗菌過濾網和過濾網框架。
*   描述如何安裝遙控器座和如何裝入電池。
*   提供室内機組的概述，包括入風口格柵、「強制自動」按鈕、前面板、人體智慧眼、上下風向導風板、排水軟管、遙控器信號接收器、省電指示燈、定時指示燈、運轉指示燈和左右風向導風板、空氣過濾網和抗菌過濾網。
*   解釋如何操作遙控器，包括按鈕功能（啟動/停止、模式選擇、溫度、風量、強勁、搖擺、睡眠等）、顯示屏上的指示燈、以及如何設定定時和離席節電。

**運轉說明**

*   詳細介紹了如何使用各種功能，如自動、冷氣、除濕、送風和暖氣模式。
*   解釋了自動除霜運轉、自動重新啟動功能和暖氣性能。
*   解釋了關於設定定時、睡眠定時、以及使用群組控制的相關操作。

**清潔與保養**

*   強調清潔前必須關閉機組並斷開電源。
*   描述了如何清潔入風口格柵、空氣過濾網和更換抗菌過濾網。
*   提醒用戶定期清潔，並強調避免使用研磨清潔劑或揮發性溶劑。

**故障排除**

*   提供一份關於可能發生的故障和相關原因的清單。
*   提供一個故障排除檢查清單，讓使用者檢查簡單問題。
*   警告用戶在某些情況下必須立即停止運轉並聯繫授權維修人員。

**其他**

*   提供台灣富士通將軍國際股份有限公司的聯絡資訊。
*   提供關於有線遙控器和群組控制的說明。
*   提供關於長時間不使用機組後注意事項。

**總體來說，本說明書全面地介紹了富士通壁掛式空調機的安全操作、維護和故障排除，提供了用戶所需的所有資訊。**
```

### 大型本地檔(超過20MB)

```python
import httpx
import base64
import google.generativeai as genai
import os
from IPython.display import display,Markdown,Latex

genai.configure(api_key=os.environ['GEMINI_API_KEY'])
model = genai.GenerativeModel(
    model_name="gemini-2.0-flash-exp"
)
sample_pdf = genai.upload_file('說明書.pdf')
response = model.generate_content(
    ['給我這個pdf檔的說明',sample_pdf]
)
print(response.text)
```

**輸出**

```markdown
好的，這是一個關於 PDF 檔案內容的說明。

這個 PDF 檔案是關於「富士通將軍」品牌空調機的使用說明書，內容包含安全注意事項、機器構造、遙控器操作、運轉模式、保養維護及故障排除等資訊。以下為更詳細的內容摘要：

**頁面 1：**
*   **封面：** 標示「使用說明書」和「空調機 壁掛式」，附上室內機的示意圖。
*   **目錄：** 列出說明書的章節，包括安全注意事項、操作、定時運轉、人體智慧眼、一般資訊、清潔保養及故障排除等。
*   **安全注意事項：** 詳細說明操作空調機時的注意事項和警告，並附上相對應的圖示（如禁止符號、警告符號等）。警告事項包含產品有可燃冷媒、機台有用戶不可自行維修部分、勿讓孩童戲耍機器等；注意事項包括保持良好通風、避免讓冷風直吹身體等。

**頁面 2：**
*   **安全注意事項（續）：** 繼續說明安全注意事項，包括避免將其他物品置於機器下方、勿使用於儲存食物等。
*   **零件介紹：**  介紹室內機組的附件（遙控器、電池、過濾網等），及如何安裝遙控器座。
*   **遙控器安裝：** 說明如何安裝電池，以及設定時間。

**頁面 3：**
*   **室內機組概述：** 詳細說明室內機的各部分名稱，如入風口格柵、「強制自動」按鈕、前面板、人體智慧眼、上下風向導風板等。並附上機組外部圖示說明。
*   **重要提醒：** 強調避免阻擋入風口/出風口、風向調整須先停止運轉等。

**頁面 4：**
*   **遙控器概述與操作：** 詳細介紹遙控器各按鈕的功能，包含開關、模式選擇、溫度設定、風量調整、強勁模式、省電模式等。
*   **遙控器顯示：**說明螢幕上的各種指示燈號，和如何調整溫度單位（攝氏/華氏）。

**頁面 5：**
*   **遙控器概述與操作（續）：** 介紹搖擺、風向調整、睡眠定時、取消定時、復歸等按鈕功能。
*   **其他按鈕：**  說明外機靜音、省電、智慧眼（離席節電）等功能按鈕。

**頁面 6：**
*   **遙控器自訂代碼設定：**  說明如何設定遙控器的自訂代碼，防止操作到其他相近空調機。
*   **定時運轉：**  詳細說明定時開機、定時關機，以及如何設定程式定時（組合使用定時開關）。
*   **睡眠定時：**  說明如何設定睡眠定時，使睡眠期間溫度更舒適。

**頁面 7：**
*   **人體智慧眼（離席節電）：**  說明人體智慧眼如何偵測房間內是否有人，並自動調節溫度，達到節能效果。
*   **功能限制：**  列出人體智慧眼可能無法準確偵測的狀況，並說明偵測範圍。

**頁面 8：**
*   **關於運轉的一般資訊：** 說明自動除霜運轉、自動重新啟動功能、暖氣性能等。
*   **其他資訊：** 介紹有線遙控器 (選配) 和群組控制 (選配)。

**頁面 9：**
*   **清潔與保養：** 強調清潔前的安全注意事項。
*   **日常保養：** 說明如何清潔室內機組、入風口格柵及空氣過濾網。

**頁面 10：**
*   **清潔與保養（續）：** 說明如何安裝和更換抗菌過濾網，以及保養負离子除臭過濾網。
*   **其他檢查：** 提醒長時間不使用機器時的注意事項，以及其他檢查項目，並說明過濾網重設功能。

**頁面 11：**
*   **故障排除：** 說明機組異常時應注意的事項，及可能發生的正常狀況。
*   **問題排查：** 列出常見的運轉問題（如無法運轉、冷暖氣效能不佳），並提供簡單的檢測方法。

**頁面 12：**
*   **廠商資訊：** 提供台灣富士通將軍國際股份有限公司的聯絡方式、網址，以及產品的購買資訊填寫欄位。

總結來說，這是一份相當詳細的空調機使用說明書，涵蓋了從安全注意事項到故障排除的所有面向，可作為使用者操作和維護機器的重要參考。

如有任何其他問題，請隨時提出。
```

### 暫時儲存pdf內容

```python
import httpx
import base64
import google.generativeai as genai
from google.generativeai import caching
import os
from IPython.display import display,Markdown,Latex

genai.configure(api_key=os.environ['GEMINI_API_KEY'])

document = genai.upload_file('說明書.pdf', mime_type='application/pdf')
cache = caching.CachedContent.create(
    model = "gemini-1.5-flash-002",
    system_instruction = '你是一個專業的分析達人',
    contents=[document]
)

model = genai.GenerativeModel.from_cached_content(cache)

response = model.generate_content("請分析這個文件")
print(response.usage_metadata)
print(response.text)
```

**輸出**

```python
prompt_token_count: 12603
candidates_token_count: 602
total_token_count: 13205
cached_content_token_count: 12598

這份文件是日文版的富士通將軍空調的中文使用說明書。它詳細描述了空調的安裝、操作、保養和故障排除。  以下是一些關鍵分析點：

**內容結構清晰，邏輯性強：**

* **目錄:**  提供了清晰的章節目錄，方便用戶快速找到所需資訊。
* **安全注意事項:**  在使用說明書的開頭就詳細說明了安全注意事項，強調了安全操作的重要性，並用不同的標誌區分了不同嚴重程度的風險。
* **圖文並茂:**  說明書中大量使用了圖表，清晰地展示了空調的組件、操作步驟和保養方法，讓使用者更容易理解。
* **步驟式教學:**  操作和保養部分採用了步驟式的教學方法，讓使用者可以循序漸進地完成操作。
* **故障排除:**  提供常見故障的解決方案，方便使用者自行處理一些簡單的問題。


**內容覆蓋全面，資訊詳盡：**

* **產品概述:**  介紹了空調的主要功能和組件。
* **操作指南:**  詳細解釋了遙控器和室內機組的操作方法，包括各種模式的設定和使用方法。
* **保養說明:**  提供了空氣過濾網、抗菌過濾網等部件的清潔和更換方法。
* **故障排除指南:**  針對常見的故障問題提供了故障排除方法和建議。
* **安全警告:**  在多處提醒用戶注意安全事宜，並特別強調了可燃冷媒的風險。


**優點：**

* **易於理解：**  文字簡潔明瞭，圖表清晰易懂，即使是不熟悉空調操作的用戶也能夠輕鬆上手。
* **安全性重視：**  多次強調安全注意事項，有效降低了使用者操作風險。
* **完整性高：**  涵蓋了空調使用的所有方面，從安裝到保養，再到故障排除，都有詳細的說明。


**不足之處：**

* **部分圖像質量不高：**  有些圖像的解析度較低，可能影響閱讀體驗（這可能是 OCR 過程中影像品質下降造成）。
* **部分文字可能翻譯不準確：**  在 OCR 轉換的過程中，某些專業術語或特殊語法可能出現翻譯不準確的情況。 (這也是基於OCR轉換的結果)


**整體評價：**

這份使用說明書是一份質量較高的文件，它結構清晰，內容完整，圖文並茂，能夠有效地指導使用者正確使用和保養空調。雖然有些圖片質量和文字翻譯可能存在不足，但並不影響其整體的实用价值。  如果可以提供原始的PDF文件，分析結果會更加準確。
```

